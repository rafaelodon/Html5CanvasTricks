<html>
	<head>
		<script src="jquery-1.6.2.min.js"></script>
	</head>
	<body>
		<center>
			<div id="text" style="width: 800px;">0,0</div>
			<canvas id="myCanvas" width="800" height="400" style="border: 1px solid black; margin-top: 40px">
				<p>Your browser doesn't support canvas.</p>
			</canvas>
		</center>
	</body>
	<script type="text/javascript">
		
		$(document).ready(function() {

			var canvas = document.getElementById('myCanvas');

			var maxLeft = 800;
			var maxTop = 400;

			var cTop = maxTop/2;
			var cLeft = maxLeft/2;

			var goal = false;
			var goalX = 0;
			var goalY = 0;
			var goalXadd = 0;
			var goalYadd = 0;
			var goalTurns = 0;

			var playerSize = 50;

			var overPlayer = false;

			var isDragging = false;

			var normalColor = "#00AA00";
			var hoverColor = "#AA0000";

			$('#myCanvas').mousemove(function(e){
				var x = e.pageX - this.offsetLeft;
				var y = e.pageY - this.offsetTop;
				$('#text').html(""+x+","+y);

				if(isDragging){
					cTop = y;
					cLeft = x;
				}

				overPlayer = isInsideCircle(x,y);
				if(overPlayer){
					$(this).css('cursor','pointer');
				}else{
					$(this).css('cursor','auto');
				}
			});

			$('#myCanvas').mousedown(function(e){
				var x = e.pageX - this.offsetLeft;
				var y = e.pageY - this.offsetTop;

				if(isInsideCircle(x,y)){
			       		if(!isDragging){
						isDragging = true;
						goal = false;
						cTop = y-5;
						cLeft = x+5;
					}
				}else{
					goal = true;
					goalX = x;
					goalY = y;
					var dX = x-cLeft;
					var dY = y-cTop;
					var dist = Math.sqrt(dX*dX + dY*dY);
					goalTurns = dist/15;
					
					goalXadd = dX/goalTurns;
					goalYadd = dY/goalTurns;
				}
			});

			$('#myCanvas').mouseup(function(e){
				if(isDragging){
					isDragging = false;
					cTop += 5;
					cLeft -= 5;

				}
			});


			function isInsideCircle(px, py){
				var dx = cLeft-px;
				var dy = cTop-py;
				var dist = Math.sqrt(dx*dx + dy*dy);
				return dist <= playerSize;
			}

			function drawCredits(context){

				context.fillStyle = "#000000";
				context.font = "9px sans-serif";
				context.fillText("odon.rafael@gmail.com", 2, 8);
			}

			function drawPlayer(playerTop, playerLeft, context){

				var color = normalColor;
				if(overPlayer){
					color = hoverColor;
				}
				context.strokeStyle = color;
				context.fillStyle = color;
				if(isDragging){
					context.shadowColor = "#666666";
					context.shadowBlur = 20;
					context.shadowOffsetX = -5;
					context.shadowOffsetY = 5;
				}
				context.beginPath();
				context.arc(playerLeft, playerTop, playerSize-1, 0, Math.PI*2, true);
				context.closePath();
				context.stroke();
				context.fill();

				resetShadow(context);

			}

			function resetShadow(context){
				context.shadowOffsetX = 0;
				context.shadowOffsetY = 0;
				context.shadowBlur = 0;
			}

			function drawBackground(context){
				context.fillStyle= "#AADDFF";
				context.fillRect(0,0,maxLeft,maxTop);
			}

			function draw(canvas){

				if(canvas.getContext) {

					var context = canvas.getContext('2d');

					drawBackground(context);
					drawPlayer(cTop,cLeft,context);
					drawCredits(context);
				}
			}

			function refresh(){
				if(goal){
					cTop += goalYadd;
					cLeft += goalXadd;
					goalTurns--;
				}
				if(goalTurns <= 0){
					goal = false;
				}
				canvas.width = canvas.width;
				draw(canvas);
			}

			var timer = setInterval(function (){ refresh();	},33);
		});
	</script>
</html>
